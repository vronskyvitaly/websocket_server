<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Test Client</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 20px;
        font-weight: bold;
      }
      .connected {
        background-color: #d4edda;
        color: #155724;
      }
      .disconnected {
        background-color: #f8d7da;
        color: #721c24;
      }
      .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }
      button {
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
      }
      .btn-primary:hover {
        background-color: #0056b3;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
      }
      .btn-success:hover {
        background-color: #1e7e34;
      }
      .btn-warning {
        background-color: #ffc107;
        color: #212529;
      }
      .btn-warning:hover {
        background-color: #e0a800;
      }
      .btn-danger {
        background-color: #dc3545;
        color: white;
      }
      .btn-danger:hover {
        background-color: #c82333;
      }
      .message-form {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      input[type='text'] {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .log {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        height: 400px;
        overflow-y: auto;
        padding: 15px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
      }
      .log-entry {
        margin-bottom: 8px;
        padding: 5px;
        border-radius: 3px;
      }
      .log-sent {
        background-color: #cfe2ff;
      }
      .log-received {
        background-color: #d1ecf1;
      }
      .log-error {
        background-color: #f8d7da;
      }
      .log-info {
        background-color: #d4edda;
      }
      .timestamp {
        color: #6c757d;
        font-size: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîå WebSocket Test Client</h1>

      <div id="status" class="status disconnected">Disconnected</div>

      <div class="controls">
        <button id="connectBtn" class="btn-primary">Connect</button>
        <button id="disconnectBtn" class="btn-danger" disabled>
          Disconnect
        </button>
        <button id="pingBtn" class="btn-success" disabled>Ping</button>
        <button id="getClientsBtn" class="btn-warning" disabled>
          Get Clients
        </button>
        <button id="clearLogBtn" class="btn-warning">Clear Log</button>
      </div>

      <div class="message-form">
        <input
          type="text"
          id="messageInput"
          placeholder="Enter message to broadcast..."
          disabled
        />
        <button id="sendBtn" class="btn-primary" disabled>
          Send Broadcast
        </button>
        <input
          type="text"
          id="echoInput"
          placeholder="Echo message..."
          disabled
        />
        <button id="echoBtn" class="btn-success" disabled>Echo</button>
      </div>

      <div id="log" class="log"></div>
    </div>

    <script>
      class WebSocketClient {
        constructor() {
          this.ws = null
          this.isConnected = false
          this.setupEventListeners()
        }

        setupEventListeners() {
          document
            .getElementById('connectBtn')
            .addEventListener('click', () => this.connect())
          document
            .getElementById('disconnectBtn')
            .addEventListener('click', () => this.disconnect())
          document
            .getElementById('pingBtn')
            .addEventListener('click', () => this.ping())
          document
            .getElementById('getClientsBtn')
            .addEventListener('click', () => this.getClients())
          document
            .getElementById('sendBtn')
            .addEventListener('click', () => this.sendBroadcast())
          document
            .getElementById('echoBtn')
            .addEventListener('click', () => this.sendEcho())
          document
            .getElementById('clearLogBtn')
            .addEventListener('click', () => this.clearLog())

          document
            .getElementById('messageInput')
            .addEventListener('keypress', (e) => {
              if (e.key === 'Enter') this.sendBroadcast()
            })

          document
            .getElementById('echoInput')
            .addEventListener('keypress', (e) => {
              if (e.key === 'Enter') this.sendEcho()
            })
        }

        connect() {
          const protocol =
            window.location.protocol === 'https:' ? 'wss:' : 'ws:'
          const wsUrl = `${protocol}//${window.location.host}`

          this.log('Connecting to ' + wsUrl, 'info')

          this.ws = new WebSocket(wsUrl)

          this.ws.onopen = () => {
            this.isConnected = true
            this.updateStatus('Connected', 'connected')
            this.updateButtons()
            this.log('‚úÖ Connected to WebSocket server', 'info')
          }

          this.ws.onmessage = (event) => {
            try {
              const message = JSON.parse(event.data)
              this.log(
                `üì© Received: ${JSON.stringify(message, null, 2)}`,
                'received'
              )
            } catch (error) {
              this.log(`üì© Received (raw): ${event.data}`, 'received')
            }
          }

          this.ws.onclose = () => {
            this.isConnected = false
            this.updateStatus('Disconnected', 'disconnected')
            this.updateButtons()
            this.log('üîå Disconnected from WebSocket server', 'info')
          }

          this.ws.onerror = (error) => {
            this.log('‚ùå WebSocket error: ' + error, 'error')
          }
        }

        disconnect() {
          if (this.ws) {
            this.ws.close()
          }
        }

        ping() {
          this.sendMessage({
            type: 'ping',
            data: null,
            timestamp: Date.now(),
          })
        }

        getClients() {
          this.sendMessage({
            type: 'get_clients',
            data: null,
            timestamp: Date.now(),
          })
        }

        sendBroadcast() {
          const input = document.getElementById('messageInput')
          const message = input.value.trim()
          if (message) {
            this.sendMessage({
              type: 'broadcast',
              data: message,
              timestamp: Date.now(),
            })
            input.value = ''
          }
        }

        sendEcho() {
          const input = document.getElementById('echoInput')
          const message = input.value.trim()
          if (message) {
            this.sendMessage({
              type: 'echo',
              data: message,
              timestamp: Date.now(),
            })
            input.value = ''
          }
        }

        sendMessage(message) {
          if (this.ws && this.ws.readyState === WebSocket.OPEN) {
            const messageStr = JSON.stringify(message)
            this.ws.send(messageStr)
            this.log(`üì§ Sent: ${JSON.stringify(message, null, 2)}`, 'sent')
          } else {
            this.log('‚ùå Cannot send message: not connected', 'error')
          }
        }

        updateStatus(text, className) {
          const status = document.getElementById('status')
          status.textContent = text
          status.className = `status ${className}`
        }

        updateButtons() {
          const connectBtn = document.getElementById('connectBtn')
          const disconnectBtn = document.getElementById('disconnectBtn')
          const pingBtn = document.getElementById('pingBtn')
          const getClientsBtn = document.getElementById('getClientsBtn')
          const sendBtn = document.getElementById('sendBtn')
          const echoBtn = document.getElementById('echoBtn')
          const messageInput = document.getElementById('messageInput')
          const echoInput = document.getElementById('echoInput')

          connectBtn.disabled = this.isConnected
          disconnectBtn.disabled = !this.isConnected
          pingBtn.disabled = !this.isConnected
          getClientsBtn.disabled = !this.isConnected
          sendBtn.disabled = !this.isConnected
          echoBtn.disabled = !this.isConnected
          messageInput.disabled = !this.isConnected
          echoInput.disabled = !this.isConnected
        }

        log(message, type = 'info') {
          const logDiv = document.getElementById('log')
          const entry = document.createElement('div')
          entry.className = `log-entry log-${type}`

          const timestamp = new Date().toLocaleTimeString()
          entry.innerHTML = `
                    <div class="timestamp">${timestamp}</div>
                    <div>${message}</div>
                `

          logDiv.appendChild(entry)
          logDiv.scrollTop = logDiv.scrollHeight
        }

        clearLog() {
          document.getElementById('log').innerHTML = ''
        }
      }

      // Initialize client when page loads
      document.addEventListener('DOMContentLoaded', () => {
        window.wsClient = new WebSocketClient()
      })
    </script>
  </body>
</html>
